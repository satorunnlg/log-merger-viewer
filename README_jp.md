# Log Merger Viewer (テキストベース版)

複数のログファイルを時間順に結合して表示するVSCode拡張機能です。各ログファイルは背景色で区別され、カーソル位置に応じて同じファイルからのログが強調表示されます。

## 主な機能

- 複数のログファイルを時間順に結合して一時ファイルに表示
- VSCodeの標準テキストエディタを使用してログファイルを表示
- ファイル毎に異なる背景色で区別
- カーソル位置のファイル部分を強調表示
- 一定時間以上のイベントがない場合、区切り線と時間間隔を表示
- 大きなログファイルにも対応する最適化された表示
- ファイルツリーの右クリックメニューからの複数ファイル選択
- 一時ファイル名にタイムスタンプを含む

## 使用方法

### ログファイルの表示

1. エクスプローラーからログファイルを選択（複数選択可）
2. 右クリックして「ログファイルを時間順に結合して表示」を選択
   - または、フォルダを右クリックしてフォルダ内のログファイルから選択

### コマンドパレットからの起動

1. `Ctrl+Shift+P`でコマンドパレットを開く
2. 「ログファイルを時間順に結合して表示」を選択
3. ファイル選択ダイアログからログファイルを選択（複数選択可）

### 結合ファイルの操作

- カーソルを動かすと、同じファイルからのログエントリが強調表示されます
- 標準のVSCode検索機能（Ctrl+F）を使用できます
- 標準のVSCodeエディタ機能が使用可能（折りたたみ、行番号表示など）

## 設定項目

拡張機能の設定は以下の方法で変更できます：
1. `Ctrl+,`を押して設定を開く
2. 「拡張機能」タブを選択
3. 「Log Merger Viewer」を選択

主な設定項目：

- `logMergerViewer.timeFormat`: ログの時刻フォーマット（momentフォーマット）
- `logMergerViewer.timeRegex`: ログから時刻を抽出する正規表現
- `logMergerViewer.colorPalette`: ファイル背景色パレット（RGBA形式）
- `logMergerViewer.highlightColor`: ホバー時のハイライト色
- `logMergerViewer.timeGapThreshold`: イベント間の空白を表示する閾値（秒）
- `logMergerViewer.deleteTempFilesOnClose`: エディタを閉じる際に一時ファイルを削除するかどうか

## 仕組み

1. 選択されたログファイルから時刻情報を抽出して解析
2. すべてのエントリを時間順にソート
3. 一時ファイルを作成して結合されたログを書き込み
4. VSCodeのテキストエディタで一時ファイルを開く
5. VSCodeのデコレーション機能を使って背景色や強調表示を適用
6. エディタを閉じたときに一時ファイルを自動的に削除

## カスタムログフォーマット対応

独自のログフォーマットに対応するには：

1. 設定から`logMergerViewer.timeFormat`と`logMergerViewer.timeRegex`を変更します。
2. `timeRegex`はログから時刻部分を抽出する正規表現です。最初のキャプチャグループが時刻として使用されます。
3. `timeFormat`は抽出された時刻文字列をパースするためのmomentフォーマットです。

例：
- タイムスタンプが`[2023/01/01 12:34:56.789]`の形式の場合
  - `timeRegex`: `\\[(\\d{4}/\\d{2}/\\d{2} \\d{2}:\\d{2}:\\d{2}\\.\\d{3})\\]`
  - `timeFormat`: `YYYY/MM/DD HH:mm:ss.SSS`

## 利点

- WebViewを使用しないため軽量
- VSCodeの標準エディタ機能をすべて利用可能
- 標準の検索・フィルタリング機能が使える
- 一時ファイルとして保存されるため再オープンが容易
- ネイティブVSCodeのテーマに自動対応

## 注意点

- 一時ファイルは`os.tmpdir()`で指定される一時ディレクトリに生成されます
- デフォルト設定では、エディタを閉じると一時ファイルは自動的に削除されます
- 一時ファイルを保持したい場合は、設定の`logMergerViewer.deleteTempFilesOnClose`をfalseに設定してください